<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Snakemake for Lattice Quantum Field Theory: Placeholders and wildcards</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../placeholders.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Snakemake for Lattice Quantum Field Theory
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Snakemake for Lattice Quantum Field Theory
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Snakemake for Lattice Quantum Field Theory
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 32%" class="percentage">
    32%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 32%" aria-valuenow="32" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../placeholders.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Running commands with Snakemake</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="python.html">2. Running Python code with Snakemake</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Placeholders and wildcards
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#making-rules-more-generic">Making rules more generic</a></li>
<li><a href="#snakemake-order-of-operations">Snakemake order of operations</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="chaining.html">4. Chaining rules</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/python.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/chaining.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/python.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Running Python code
        </a>
        <a class="chapter-link float-end" href="../instructor/chaining.html" rel="next">
          Next: Chaining rules...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Placeholders and wildcards</h1>
        <p>Last updated on 2025-01-28 |

        <a href="https://github.com/edbennett/snakemake-novice-lattice/edit/main/episodes/placeholders.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I make a generic rule?</li>
<li>How does Snakemake decide what rule to run?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Use Snakemake to compute the plaquette in any file</li>
<li>Understand the basic steps Snakemake goes through when running a
workflow</li>
<li>See how Snakemake deals with some errors</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="making-rules-more-generic">Making rules more generic<a class="anchor" aria-label="anchor" href="#making-rules-more-generic"></a></h2>
<hr class="half-width"><p>In the previous two episodes, we wrote rules to count the number of
generated trajectories in, and compute the average plaquette of, one
ensemble. As a reminder, this was one such rule:</p>
<pre class="snakemake"><code>rule count_trajectories:
    input: "raw_data/beta4.0/out_pg"
    output: "intermediary_data/beta4.0/pg.count"
    shell:
        "grep -c generated raw_data/beta4.0/out_pg &gt; intermediary_data/beta4.0/pg.count"</code></pre>
<p>When we needed to do the same for a second ensemble, we made a second
copy of the rule, and changed the input and output filenames. This is
obviously not scalable to large analyses: instead, we would like to
write one rule for each type of operation we are interested in. To do
this, we’ll need to use <strong>placeholders</strong> and
<strong>wildcards</strong>. Such a generic rule might look as
follows:</p>
<pre class="snakemake"><code># Count number of generated trajectories for any ensemble
rule count_trajectories:
    input: "raw_data/{subdir}/out_pg"
    output: "intermediary_data/{subdir}/pg.count"
    shell:
        "grep -c {input} &gt; {output}"</code></pre>
<div id="comments-in-snakefiles" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="comments-in-snakefiles" class="callout-inner">
<h3 class="callout-title">Comments in Snakefiles</h3>
<div class="callout-content">
<p>In the above code, the line beginning <code>#</code> is a comment
line. Hopefully you are already in the habit of adding comments to your
own software. Good comments make any code more readable, and this is
just as true with Snakefiles.</p>
</div>
</div>
</div>
<p><code>{subdir}</code> here is an example of a
<strong>wildcard</strong> Wildcards are used in the <code>input</code>
and <code>output</code> lines of the rule to represent parts of
filenames. Much like the <code>*</code> pattern in the shell, the
wildcard can stand in for any text in order to make up the desired
filename. As with naming your rules, you may choose any name you like
for your wildcards; so here we used <code>subdir</code>, since it is
describing a subdirectory. If <code>subdir</code> is set to
<code>beta4.0</code> then the new generic rule will have the same inputs
and outputs as the original rule. Using the same wildcards in the input
and output is what tells Snakemake how to match input files to output
files.</p>
<p>If two rules use a wildcard with the same name then Snakemake will
treat them as different entities—rules in Snakemake are self-contained
in this way.</p>
<p>Meanwhile, <code>{input}</code> and <code>{output}</code> are
<strong>placeholders</strong> Placeholders are used in the
<code>shell</code> section of a rule. Snakemake will replace them with
appropriate values before running the command: <code>{input}</code> with
the full name of the input file, and <code>{output}</code> with the full
name of the output file.</p>
<p>If we had wanted to include the value of the <code>subdir</code>
wildcard directly in the <code>shell</code> command, we could have used
the placeholder <code>{wildcards.subdir}</code>, but in most cases, as
here, we just need the <code>{input}</code> and <code>{output}</code>
placeholders.</p>
<p>Let’s test this general rule now:</p>
<pre class="shellsession"><code>snakemake --jobs 1 --forceall --printshellcmds --use-conda intermediary_data/beta4.0/pg.count</code></pre>
<p>As previously, if you see errors at this point, there is likely a
problem with your Snakefile; check that all the rules match the ones
that have appeared here, and that there aren’t multiple rules with the
same name.</p>
<div id="general-plaquette-computation" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="general-plaquette-computation" class="callout-inner">
<h3 class="callout-title">General plaquette computation</h3>
<div class="callout-content">
<p>Modify your Snakefile so that it can compute the average plaquette
for any ensemble, not just the ones we wrote specific rules for in the
previous episode.</p>
<p>Test this with some of the values of <span class="math inline">\(\beta\)</span> present in the raw data.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The replacement rule should look like:</p>
<pre class="snakemake"><code># Compute average plaquette for any ensemble from its generation log
rule avg_plaquette:
    input: "raw_data/{subdir}/out_pg"
    output: "intermediary_data/{subdir}/pg.plaquette.json"
    conda: "../envs/analysis.yml"
    shell:
        "python -m su2pg_analysis.plaquette {input} --output_file {output}"</code></pre>
<p>To test this, for example:</p>
<pre class="shellsession"><code>snakemake --jobs 1 --forceall --printshellcmds --use-conda intermediary_data/beta3.0/pg.count</code></pre>
</div>
</div>
</div>
</div>
<div id="choosing-the-right-wildcards" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="choosing-the-right-wildcards" class="callout-inner">
<h3 class="callout-title">Choosing the right wildcards</h3>
<div class="callout-content">
<p>Our rule puts the sequence counts into output files named like
<code>pg.count</code>. How would you have to change the
`count_trajectories`` rule definition if you wanted:</p>
<ol style="list-style-type: decimal"><li><p>the output file for <code>raw_data/beta3.0/out_hmc</code> to be
<code>intermediary_data/beta3.0/hmc.count</code>?</p></li>
<li><p>the output file for
<code>raw_data/beta3.0/mass_fun-0.63/out_hmc</code> to be
<code>intermediary_data/beta3.0/mass_fun-0.63/hmc.count</code>?</p></li>
<li><p>the output file for
<code>raw_data/beta3.0/mass_fun-0.63/out_hmc</code> to be
<code>intermediary_data/hmc_b3.0_m-0.63.count</code> (for
<code>raw_data/beta3.5/mass_fun-0.68/out_pg</code> to be
<code>intermediary_data/hmc_b3.5_m-0.68.count</code>, etc.)?</p></li>
<li><p>the output file for
<code>raw_data/beta3.0/mass_fun-0.63/out_hmc</code> to be
<code>intermediary_data/hmc_m-0.63.count</code> (for
<code>raw_data/beta3.5/mass_fun-0.68/out_pg</code> to be
<code>intermediary_data/hmc_m-0.68.count</code>, etc.)?</p></li>
</ol><p>(Assume that both pure-gauge and HMC logs tag generated trajectories
the same way. Note that input files for the latter data are not included
in the sample data, so these will not work as-is.)</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>In both cases, there is no need to change the <code>shell</code> part
of the rule at all.</p>
<ol style="list-style-type: decimal"><li>
</li></ol><pre class="snakemake"><code><span><span class="va">input</span><span class="op">:</span> <span class="st">"raw_data/{subdir}/out_hmc"</span></span>
<span><span class="va">output</span><span class="op">:</span> <span class="st">"intermediary_data/{subdir}/hmc.count"</span></span></code></pre>
<p>This can be done by changing only the static parts of the
<code>input:</code> and <code>output:</code> lines.</p>
<ol start="2" style="list-style-type: decimal"><li>
</li></ol><p>This in fact requires no change from the previous answer. The
wildcard <code>{subdir}</code> can include <code>/</code>, so can
represent multiple levels of subdirectory.</p>
<ol start="3" style="list-style-type: decimal"><li>
</li></ol><pre class="snakemake"><code><span><span class="va">input</span><span class="op">:</span> <span class="st">"raw_data/beta{beta}/mass_fun{mass}/out_hmc"</span></span>
<span><span class="va">output</span><span class="op">:</span> <span class="st">"intermediary_data/hmc_b{beta}_m{mass}.count"</span></span></code></pre>
<p>In this case, it was necessary to change the wildcards, because the
subdirectory name needs to be split to obtain the values of <span class="math inline">\(\beta\)</span> and <span class="math inline">\(m_{\mathrm{fun}}\)</span>. The names chosen here
are <code>{beta}</code> and <code>{mass}</code>, but you could choose
any names, as long as they match between the <code>input</code> and
<code>output</code> parts.</p>
<ol start="4" style="list-style-type: decimal"><li>
</li></ol><p>This one <strong>isn’t possible</strong>, because Snakemake cannot
determine which input file you want to count by matching wildcards on
the file name <code>intermediary_data/hmc_m-0.63.count</code>. You could
try a rule like this:</p>
<pre class="snakemake"><code><span><span class="va">input</span><span class="op">:</span> <span class="st">"raw_data/beta3.0/mass_fun{mass}/out_hmc"</span></span>
<span><span class="va">output</span><span class="op">:</span> <span class="st">"intermediary_data/hmc_m{mass}.count"</span></span></code></pre>
<p>…but it only works because <span class="math inline">\(\beta\)</span>
is hard-coded into the <code>input</code> line, and the rule will only
work on this specific sample, not other cases where other values of
<span class="math inline">\(\beta\)</span> may be wanted. In general,
input and output filenames need to be carefully chosen so that Snakemake
can match everything up and determine the right input from the output
filename.</p>
</div>
</div>
</div>
</div>
<div id="filenames-arent-data" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="filenames-arent-data" class="callout-inner">
<h3 class="callout-title">Filenames aren’t data</h3>
<div class="callout-content">
<p>Notice that in some examples we can pull out the value of <span class="math inline">\(\beta\)</span> from the name of the directory in
which the file is located. However, ideally, we should avoid relying on
this being correct. The name and location are useful for us to find the
correct file, but we should try to ensure that the file contents also
contain these data, and that we make use of those data in preference to
the filename.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="snakemake-order-of-operations">Snakemake order of operations<a class="anchor" aria-label="anchor" href="#snakemake-order-of-operations"></a></h2>
<hr class="half-width"><p>We’re only just getting started with some simple rules, but it’s
worth thinking about exactly what Snakemake is doing when you run it.
There are three distinct phases:</p>
<ol style="list-style-type: decimal"><li>Prepares to run:
<ol style="list-style-type: decimal"><li>Reads in all the rule definitions from the Snakefile</li>
</ol></li>
<li>Plans what to do:
<ol style="list-style-type: decimal"><li>Sees what file(s) you are asking it to make</li>
<li>Looks for a matching rule by looking at the <code>output</code>s of
all the rules it knows</li>
<li>Fills in the wildcards to work out the <code>input</code> for this
rule</li>
<li>Checks that this input file is actually available</li>
</ol></li>
<li>Runs the steps:
<ol style="list-style-type: decimal"><li>Creates the directory for the output file, if needed</li>
<li>Removes the old output file if it is already there</li>
<li>Only then, runs the shell command with the placeholders
replaced</li>
<li>Checks that the command ran without errors <em>and</em> made the new
output file as expected</li>
</ol></li>
</ol><p>For example, if we now ask Snakemake to generate a file named
<code>intermediary_data/wibble_1/pg.count</code>:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$ snakemake --jobs 1 --forceall --printshellcmds intermediary_data/wibble_1/pg.count
Building DAG of jobs...
MissingInputException in line 1 of /home/zenmaster/data/su2pg/workflow/Snakefile:
Missing input files for rule count_trajectories:
raw_data/wibble_1/out_pg</code></pre>
</div>
<p>Snakemake sees that a file with a name like this could be produced by
the <code>count_trajectories</code> rule. However, when it performs the
wildcard substitution it sees that the input file would need to be named
<code>raw_data/wibble_1/out_pg</code>, and there is no such file
available. Therefore Snakemake stops and gives an error before any shell
commands are run.</p>
<div id="dry-run---dry-run-mode" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dry-run---dry-run-mode" class="callout-inner">
<h3 class="callout-title">Dry-run (<code>--dry-run</code>) mode</h3>
<div class="callout-content">
<p>It’s often useful to run just the first two phases, so that Snakemake
will plan out the jobs to run, and print them to the screen, but never
actually run them. This is done with the <code>--dry-run</code> flag,
eg:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> snakemake <span class="at">--dry-run</span> <span class="at">--forceall</span> <span class="at">--printshellcmds</span> temp33_1_1.fq.count</span></code></pre>
</div>
<p>We’ll make use of this later in the lesson.</p>
</div>
</div>
</div>
<p>The amount of checking may seem pedantic right now, but as the
workflow gains more steps this will become very useful to us indeed.</p>
<!-- maybe add an extra challenge here? -->
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Snakemake rules are made generic with placeholders and
wildcards</li>
<li>Snakemake chooses the appropriate rule by replacing wildcards such
the the output matches the target</li>
<li>Placeholders in the shell part of the rule are replaced with values
based on the chosen wildcards</li>
<li>Snakemake checks for various error conditions and will stop if it
sees a problem</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/python.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/chaining.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/python.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Running Python code
        </a>
        <a class="chapter-link float-end" href="../instructor/chaining.html" rel="next">
          Next: Chaining rules...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/edbennett/snakemake-novice-lattice/edit/main/episodes/placeholders.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/edbennett/snakemake-novice-lattice/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/edbennett/snakemake-novice-lattice/" class="external-link">Source</a></p>
				<p><a href="https://github.com/edbennett/snakemake-novice-lattice/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:e.j.bennett@swansea.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://edbennett.github.io/snakemake-novice-lattice/instructor/placeholders.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, snakemake, lattice quantum field theory",
  "name": "Placeholders and wildcards",
  "creativeWorkStatus": "active",
  "url": "https://edbennett.github.io/snakemake-novice-lattice/instructor/placeholders.html",
  "identifier": "https://edbennett.github.io/snakemake-novice-lattice/instructor/placeholders.html",
  "dateCreated": "2025-01-03",
  "dateModified": "2025-01-28",
  "datePublished": "2025-03-11"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

